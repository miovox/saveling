# Story 1.1: Family Account Creation & Login

## Status
Draft

## Story
**As an** Adult,
**I want** to create a new family account with a single, family-wide password,
**so that** I can establish a private and secure space for our finances.

## Acceptance Criteria
1. A user can access a sign-up/login page.
2. A user can create a new "Family" account by providing a Family Name and a password.
3. The Family Name must be unique across the system.
4. The password must be securely stored (hashed).
5. A user can subsequently log in using the correct family credentials.

## Tasks / Subtasks
- [ ] **Task 1: Set up database schema and Prisma configuration** (AC: 2, 3, 4)
  - [ ] Create Prisma schema file at `packages/db/schema.prisma`
  - [ ] Define Family model with handle, displayName, passwordHash fields
  - [ ] Configure UUID primary keys and unique constraints
  - [ ] Set up database connection configuration
  - [ ] Run initial migration
- [ ] **Task 2: Create authentication service layer** (AC: 2, 3, 4, 5)
  - [ ] Create `apps/web/services/auth.service.ts` with family creation and login functions
  - [ ] Implement password hashing using bcrypt
  - [ ] Implement family handle uniqueness validation
  - [ ] Create NextAuth.js configuration for family-based authentication
- [ ] **Task 3: Implement family registration API endpoint** (AC: 2, 3, 4)
  - [ ] Create `apps/web/app/api/family/route.ts` for POST requests
  - [ ] Implement request validation for family name and password
  - [ ] Call auth service for family creation
  - [ ] Return appropriate success/error responses
- [ ] **Task 4: Implement login API endpoint** (AC: 5)
  - [ ] Create `apps/web/app/api/auth/login/route.ts` for POST requests
  - [ ] Implement credential validation against Family model
  - [ ] Set up session management using NextAuth.js
  - [ ] Return authentication tokens/session data
- [ ] **Task 5: Create sign-up/login UI components** (AC: 1)
  - [ ] Create `apps/web/components/auth/FamilyRegistrationForm.tsx`
  - [ ] Create `apps/web/components/auth/FamilyLoginForm.tsx`
  - [ ] Implement form validation using React Hook Form
  - [ ] Style components using Tailwind CSS and Shadcn/ui
- [ ] **Task 6: Create authentication pages** (AC: 1)
  - [ ] Create `apps/web/app/auth/signup/page.tsx`
  - [ ] Create `apps/web/app/auth/login/page.tsx`
  - [ ] Implement responsive design for mobile and desktop
  - [ ] Add navigation between signup and login pages
- [ ] **Task 7: Implement client-side API service** (AC: 2, 5)
  - [ ] Create `apps/web/services/family.service.ts` for API calls
  - [ ] Implement family registration function
  - [ ] Implement family login function
  - [ ] Handle API errors and success responses
- [ ] **Task 8: Add comprehensive testing** (AC: All)
  - [ ] Unit tests for auth service functions
  - [ ] API route tests for registration and login endpoints
  - [ ] Component tests for forms using React Testing Library
  - [ ] Integration tests for complete registration and login flows

## Dev Notes

### Previous Story Insights
No previous stories exist - this is the foundation story for the application.

### Data Models
**Family Model** [Source: architecture/04-data-models.md#model-family]:
- `id: string` - UUID primary key, auto-generated
- `handle: string` - The unique login handle (family name)
- `displayName: string` - The friendly display name
- `passwordHash: string` - Securely hashed password

**Database Schema** [Source: architecture/09-database-schema.md]:
```prisma
model Family {
  id           String @id @default(uuid())
  handle       String @unique
  displayName  String
  passwordHash String
  users        User[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
```

### API Specifications
**Family Registration Endpoint** [Source: architecture/05-api-specification.md]:
- `POST /api/family` - Create a new Family account

**Authentication Endpoint** [Source: architecture/05-api-specification.md]:
- `POST /api/auth/login` - Log in to a Family account

### Component Specifications
**Frontend Architecture** [Source: architecture/10-frontend-architecture.md]:
- Feature-based folder structure: authentication components in `features/auth/components`
- Core UI elements in `components/ui`
- Zustand for state management
- Next.js App Router for routing
- Centralized API client for service functions

### File Locations
**Project Structure** [Source: architecture/12-unified-project-structure.md]:
- Next.js application: `apps/web/`
- API routes: `apps/web/app/api/`
- React components: `apps/web/components/`
- Backend services: `apps/web/services/`
- Prisma schema: `packages/db/`
- Shared types: `packages/shared-types/`

### Technical Constraints
**Tech Stack** [Source: architecture/03-tech-stack.md]:
- Frontend: Next.js 14.x with TypeScript 5.x
- Authentication: NextAuth.js (Auth.js) 5.x
- Database: Prisma 5.x with PlanetScale
- UI: Shadcn/ui with Tailwind CSS 3.x
- Testing: Jest & React Testing Library

**Coding Standards** [Source: architecture/17-coding-standards.md]:
- Enforce type sharing from `packages/shared-types` directory
- Use API service layer for all frontend data fetching
- Do not access database directly from API routes - use service functions
- Use immutable state patterns
- PascalCase for components, camelCase for hooks and services

**Backend Architecture** [Source: architecture/11-backend-architecture.md]:
- API routes call service functions, not Prisma directly
- Business logic abstracted into service files (e.g., `services/auth.service.ts`)
- NextAuth.js handles login flow and secures API routes

## Testing

### Testing Standards
**Testing Strategy** [Source: architecture/16-testing-strategy.md]:
- Focus on Unit Tests with smaller layer of Integration Tests
- Tests co-located with source code (e.g., `Button.test.tsx`)
- Tools: Jest and React Testing Library

**Test Requirements for this Story**:
- Unit tests for all service functions (auth.service.ts, family.service.ts)
- API route tests for `/api/family` and `/api/auth/login`
- Component tests for registration and login forms
- Integration tests covering complete user flows from form submission to successful authentication
- Database integration tests for Family model operations

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-15 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*To be filled by QA agent after story completion*